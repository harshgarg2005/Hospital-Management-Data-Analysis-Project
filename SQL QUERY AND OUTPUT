create database Hospital_Management_Data;
Use Hospital_Management_Data;

#Case Study By The Database

#Q.1 How many patients registered in each year?
#Ans:-
SELECT
    YEAR(registration_date) AS registration_year,
    COUNT(patient_id) AS total_patients_registered
FROM
    patient
GROUP BY
    registration_year
ORDER BY
    registration_year;

#OUTPUT:-
registration_year |   total_patients_registered
NULL              |   50


#Q.2 Identify patients who have paid more than the average billing amount for their treatments?
#Ans:
SELECT
    DISTINCT p.first_name,
    p.last_name
FROM
    patient p
JOIN
    billing b ON p.patient_id = b.patient_id
WHERE
    b.amount > (SELECT AVG(amount) FROM billing)
ORDER BY
    p.first_name, p.last_name;

#OUTPUT

first_name | last_name
Alex         Johnson
Alex         Moore
Alex         Smith
Alex         Taylor
David        Moore
David        Smith
David        Williams
David        Wilson
Emily        Jones
Emily        Miller
Emily        Smith
Emily        Williams
Jane         Jones
Jane         Moore
Jane         Wilson
John         Brown
John         Taylor
Laura        Davis
Laura        Johnson
Laura        Jones
Laura        Wilson
Linda        Johnson
Linda        Miller
Michael      Johnson
Michael      Taylor
Michael      Wilson
Robert       Miller
Robert       Taylor
Robert       Williams
Robert       Wilson
Sarah        Brown
Sarah        Miller
    
#Q.3 What is the most common reason for a visit?
#Ans:
SELECT
    reason_for_visit,
    COUNT(*) AS visit_count
FROM
    appointment
GROUP BY
    reason_for_visit
ORDER BY
    visit_count DESC
LIMIT 1;

#OUTPUT:-
reason_for_visit	 |   visit_count
Checkup	           |   45


#Q.4 List all patients who are insured by Wellness Corp?
#Ans: 
SELECT
    patient_id,
    first_name,
    last_name,
    insurance_provider
FROM
    patient
WHERE insurance_provider = "WellnessCorp";

OUTPUT:-
patient_id       first_name       last_name       insurance_provider
P001	           David	          Williams      	WellnessCorp
P008	           David	          Davis	          WellnessCorp
P010	           Michael          Taylor      	  WellnessCorp
P013	           Laura	          Johnson	        WellnessCorp
P015	           Sarah	          Johnson        	WellnessCorp
P017	           Jane	            Jones          	WellnessCorp
P019       	     Sarah            Miller	        WellnessCorp
P021	           Michael          Wilson	        WellnessCorp
P023	           Linda	          Johnson	        WellnessCorp
P024      	     Sarah            Brown	          WellnessCorp
P031      	     Robert           Miller	        WellnessCorp
P034      	     Alex	            Smith	          WellnessCorp
P041      	     Robert	          Williams	      WellnessCorp
P043	           Linda	          Brown          	WellnessCorp
P047	           Jane             Moore	          WellnessCorp
P050	           Laura            Wilson	        WellnessCorp

#Q.5 Find the top 3 patients with the highest total amount billed, and list their total amount.
#Ans:
SELECT
    p.first_name,
    p.last_name,
    SUM(b.amount) AS total_billed_amount
FROM
    patient p
JOIN
    billing b ON p.patient_id = b.patient_id
GROUP BY
    p.patient_id, p.first_name, p.last_name
ORDER BY
    total_billed_amount DESC
LIMIT 3;

#Q.6 Find the total revenue generated by each doctor, considering only 'Paid' bills?
#Ans
SELECT
    d.first_name,
    d.last_name,
    SUM(b.amount) AS total_paid_revenue
FROM
    doctors d
JOIN
    appointment a ON d.doctor_id = a.doctor_id
JOIN
    billing b ON a.patient_id = b.patient_id -- Link patient through appointment to billing
WHERE
    b.payment_status = 'Paid'
GROUP BY
d.first_name, d.last_name ORDER BY total_paid_revenue DESC;

#Q.7 Which doctor has the highest average billing amount per treatment?
#Ans:
SELECT
    d.first_name,  d.last_name,
    AVG(b.amount) AS average_billing_amount_per_treatment
FROM
    doctors d
JOIN
    appointment a ON d.doctor_id = a.doctor_id
JOIN
    billing b ON a.patient_id = b.patient_id
GROUP BY
    d.doctor_id, d.first_name, d.last_name
ORDER BY
    average_billing_amount_per_treatment DESC
LIMIT 1;

#Q.8 For each month, what is the total number of appointments and total billing amount?
#Ans:
SELECT
    DATE_FORMAT(a.appointment_date, '%Y-%m') AS appointment_month,
    COUNT(a.appointment_id) AS total_appointments,
    SUM(b.amount) AS total_billing_amount
FROM
    appointment a
LEFT JOIN
    billing b ON a.patient_id = b.patient_id
GROUP BY
    appointment_month
ORDER BY
    appointment_month;

#Q.9 List the patients who have appointments with 'Dr. David Taylorâ€™?
#Ans:
SELECT
    DISTINCT p.first_name,
    p.last_name
FROM
    patient p
JOIN
    appointment a ON p.patient_id = a.patient_id
JOIN
    doctors d ON a.doctor_id = d.doctor_id
WHERE
    d.first_name = 'David' AND d.last_name = 'Taylor';

#Q.10 How many appointments are scheduled for each doctor?
#Ans:
SELECT
    d.first_name,
    d.last_name,
    COUNT(a.appointment_id) AS total_appointments
FROM
    doctors d
LEFT JOIN
    appointment a ON d.doctor_id = a.doctor_id
GROUP BY
    d.doctor_id, d.first_name, d.last_name
ORDER BY
    total_appointments DESC, d.first_name, d.last_name;
